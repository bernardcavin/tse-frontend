import{d as L,j as e,S as p,h as M,ah as f,Q as w,T as d,a8 as D,at as N,k as U,r as I,m as G,W as _,X as P,e as S,au as H,av as F,p as E}from"./index--ClWZahu.js";import{P as K}from"./page-CknD4dKm.js";import{P as V}from"./page-header-BWjuV_E8.js";import{a as Y,u as $,b as J}from"./it-tickets-DsHk8ugn.js";import{I as z}from"./IconTicket-CR3jGm9-.js";import{c as Q}from"./createReactComponent-BM7tdotx.js";import{I as W,P as O,L as X}from"./IconClock-DZ2a-qfR.js";import{I as q}from"./IconCheck-DpEWvlmQ.js";import{G as v}from"./form-section-C5VgLGpa.js";import{T as A}from"./Title-Ci985OzB.js";import{D as c,A as Z}from"./index-DqV8S-Pt.js";import{a as ee,b as te,c as se,d as ie,o as re}from"./it-tickets-modals-RD9q3f5d.js";import{a as oe}from"./IconX-DuMbzP0j.js";import"./Anchor-DIBe1ZWb.js";import"./index-Bn0zxFJ3.js";import"./Select-UMZ64bLE.js";import"./file-upload-DQ7A5yty.js";import"./form-CN9S1QwI.js";import"./facilities-BJtlO5v9.js";import"./facility-CsGiLvNK.js";import"./use-form-L8LbUW_M.js";import"./IconPlus-BmH8SaqF.js";/**
 * @license @tabler/icons-react v3.14.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var ae=Q("outline","urgent","IconUrgent",[["path",{d:"M8 16v-4a4 4 0 0 1 8 0v4",key:"svg-0"}],["path",{d:"M3 12h1m8 -9v1m8 8h1m-15.4 -6.4l.7 .7m12.1 -.7l-.7 .7",key:"svg-1"}],["path",{d:"M6 16m0 1a1 1 0 0 1 1 -1h10a1 1 0 0 1 1 1v2a1 1 0 0 1 -1 1h-10a1 1 0 0 1 -1 -1z",key:"svg-2"}]]);function ne(){var n,y,C,b;const{user:s}=L(),{data:r,isLoading:m}=Y();if((s==null?void 0:s.role)!=="MANAGER"&&(s==null?void 0:s.department)!=="IT"||m||!r)return null;const g=Object.entries(r.status_breakdown||{}).map(([i,l])=>({name:i.replace("_"," ").toUpperCase(),value:l,color:i==="open"?"red.6":i==="in_progress"?"yellow.6":i==="resolved"?"green.6":"gray.6"})).filter(i=>i.value>0),j=Object.entries(r.category_breakdown||{}).map(([i,l])=>({category:i.replace("_"," "),count:l})).sort((i,l)=>l.count-i.count),x=(r.monthly_trend||[]).map(i=>({month:i.month||"N/A",tickets:i.count||0})),T=Object.entries(r.priority_breakdown||{}).map(([i,l])=>({name:i.toUpperCase(),value:l,color:i==="critical"?"red.6":i==="high"?"orange.6":i==="medium"?"yellow.6":"gray.6"})).filter(i=>i.value>0),k=[{title:"Total Tickets",value:r.total_tickets||0,icon:z,color:"blue"},{title:"Open",value:((n=r.status_breakdown)==null?void 0:n.open)||0,icon:ae,color:"red"},{title:"In Progress",value:((y=r.status_breakdown)==null?void 0:y.in_progress)||0,icon:W,color:"yellow"},{title:"Resolved",value:((C=r.status_breakdown)==null?void 0:C.resolved)||0,icon:q,color:"green"}],u=r.total_tickets||0,o=((b=r.status_breakdown)==null?void 0:b.resolved)||0,h=u>0?(o/u*100).toFixed(1):"0.0",a=r.avg_resolution_hours||0;return e.jsxs(p,{gap:"lg",mb:"lg",children:[e.jsx(M,{cols:{base:1,sm:2,md:4},children:k.map(i=>{const l=i.icon;return e.jsx(f,{padding:"md",radius:"md",withBorder:!0,children:e.jsxs(w,{justify:"space-between",children:[e.jsxs(p,{gap:0,children:[e.jsx(d,{size:"xs",c:"dimmed",fw:500,children:i.title}),e.jsx(d,{size:"xl",fw:700,children:i.value})]}),e.jsx(l,{size:32,stroke:1.5,color:`var(--mantine-color-${i.color}-6)`})]})},i.title)})}),e.jsxs(v,{children:[e.jsx(v.Col,{span:{base:12,md:6},children:e.jsx(f,{padding:"lg",radius:"md",withBorder:!0,h:"100%",children:e.jsxs(p,{gap:"md",children:[e.jsxs(w,{justify:"space-between",children:[e.jsx(A,{order:4,children:"Status Distribution"}),e.jsxs(d,{size:"sm",c:"dimmed",children:["Resolution Rate: ",h,"%"]})]}),e.jsx(D,{children:g.length>0?e.jsx(O,{data:g,withLabelsLine:!0,labelsPosition:"outside",labelsType:"value",withLabels:!0,withTooltip:!0,tooltipDataSource:"segment"}):e.jsx(d,{size:"sm",c:"dimmed",ta:"center",py:"xl",children:"No data available"})})]})})}),e.jsx(v.Col,{span:{base:12,md:6},children:e.jsx(f,{padding:"lg",radius:"md",withBorder:!0,h:"100%",children:e.jsxs(p,{gap:"md",children:[e.jsx(A,{order:4,children:"Tickets by Category"}),j.length>0?e.jsx(N,{h:280,data:j,dataKey:"category",series:[{name:"count",color:"blue.6",label:"Count"}],tickLine:"y",gridAxis:"y",withTooltip:!0,withLegend:!0,tooltipAnimationDuration:200,xAxisProps:{angle:-45,textAnchor:"end",height:100}}):e.jsx(d,{size:"sm",c:"dimmed",ta:"center",py:"xl",children:"No data available"})]})})}),e.jsx(v.Col,{span:{base:12,md:8},children:e.jsx(f,{padding:"lg",radius:"md",withBorder:!0,children:e.jsxs(p,{gap:"md",children:[e.jsx(A,{order:4,children:"Tickets Trend (Last 6 Months)"}),x.length>0?e.jsx(X,{h:300,data:x,dataKey:"month",series:[{name:"tickets",color:"blue.6",label:"Tickets"}],curveType:"linear",withTooltip:!0,withLegend:!0,tooltipAnimationDuration:200,connectNulls:!0,withDots:!0,gridAxis:"xy"}):e.jsx(d,{size:"sm",c:"dimmed",ta:"center",py:"xl",children:"No data available"})]})})}),e.jsx(v.Col,{span:{base:12,md:4},children:e.jsx(f,{padding:"lg",radius:"md",withBorder:!0,h:"100%",children:e.jsxs(p,{gap:"md",children:[e.jsx(A,{order:4,children:"Priority Distribution"}),e.jsx(D,{children:T.length>0?e.jsx(O,{data:T,withLabelsLine:!0,labelsPosition:"outside",labelsType:"value",withLabels:!0,withTooltip:!0,tooltipDataSource:"segment"}):e.jsx(d,{size:"sm",c:"dimmed",ta:"center",py:"xl",children:"No data available"})}),e.jsx(p,{gap:"xs",children:e.jsxs(w,{justify:"space-between",children:[e.jsx(d,{size:"sm",c:"dimmed",children:"Avg. Resolution Time"}),e.jsxs(d,{size:"sm",fw:600,children:[a," hours"]})]})})]})})})]})]})}const le={open:"red",in_progress:"yellow",resolved:"green",closed:"gray"},ce={open:"Open",in_progress:"In Progress",resolved:"Resolved",closed:"Closed"},de={hardware:"Hardware",software:"Software",network:"Network",account_access:"Account/Access",other:"Other"},ue={low:"gray",medium:"blue",high:"orange",critical:"red"},he={low:"Low",medium:"Medium",high:"High",critical:"Critical"};async function pe(){const s=await H.get("/it-tickets/export/csv");return F.parse(s.data).data}function me(s,r){if(s.length===0)return;const m={title:"Judul",description:"Deskripsi",category:"Kategori",priority:"Prioritas",status:"Status",reporter:"Pelapor",facility:"Fasilitas",inventory_item:"Item Inventaris",assigned_to:"Ditugaskan Ke",resolved_by:"Diselesaikan Oleh",resolved_at:"Tanggal Penyelesaian",resolution_notes:"Catatan Penyelesaian",created_at:"Tanggal Dibuat"},g=Object.keys(s[0]),j=g.map(h=>m[h]||h).join(","),x=s.map(h=>g.map(a=>{const n=h[a]??"";return n.includes(",")||n.includes('"')||n.includes(`
`)?`"${n.replace(/"/g,'""')}"`:n}).join(",")),T=[j,...x].join(`
`),k=new Blob([T],{type:"text/csv;charset=utf-8;"}),u=URL.createObjectURL(k),o=document.createElement("a");o.href=u,o.setAttribute("download",r),document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(u)}function ge(){var R;const{user:s}=L(),{page:r,limit:m,setLimit:g,setPage:j}=U(),{filters:x,sort:T}=c.useDataTable({sortConfig:{direction:"desc",column:"created_at"}}),[k,u]=I.useState(!1),{data:o,isLoading:h,refetch:a}=$(),{mutate:n}=J(),y=I.useCallback(t=>{G.openConfirmModal({title:"Delete IT Ticket",children:"Are you sure you want to delete this IT ticket?",confirmProps:{color:"red"},labels:{confirm:"Delete",cancel:"Cancel"},onConfirm:()=>{n(t),a()}})},[n,a]),C=I.useCallback(async()=>{u(!0);try{const t=await pe();if(!t||t.length===0){_.show({message:"No data to export",color:"yellow"});return}const B=`it_tickets_${new Date().toISOString().split("T")[0]}.csv`;me(t,B),_.show({title:"Export Berhasil",message:"File berhasil diunduh",color:"green"})}catch(t){console.error("Export failed:",t),_.show({message:"Export failed: "+t,color:"red"})}finally{u(!1)}},[]),b=(s==null?void 0:s.department)==="IT",i=(s==null?void 0:s.role)==="MANAGER",l=I.useMemo(()=>[{accessor:"title",title:"Title",ellipsis:!0,width:200},{accessor:"category",title:"Category",render:({category:t})=>e.jsx(P,{variant:"light",children:de[t]})},{accessor:"priority",title:"Priority",sortable:!0,render:({priority:t})=>e.jsx(P,{color:ue[t],children:he[t]})},{accessor:"status",title:"Status",sortable:!0,textAlign:"center",render:({status:t})=>e.jsx(P,{color:le[t],children:ce[t]})},{accessor:"assigned_to_id",title:"Assigned To",ellipsis:!0,render:({assigned_to_name:t})=>t||"-"},{accessor:"created_at",title:"Created",sortable:!0,render:({created_at:t})=>t?new Date(t).toLocaleDateString():"-"},{accessor:"actions",title:"Actions",textAlign:"right",width:200,render:t=>e.jsxs(w,{gap:"xs",justify:"flex-end",children:[e.jsx(c.Actions,{onView:()=>ee(t.id),onResolve:(b||i)&&t.status!=="resolved"&&t.status!=="closed"?()=>te(t.id,a):null,onEdit:i||t.reporter_id===(s==null?void 0:s.id)?()=>se(t.id,a):null,onDelete:i||t.reporter_id===(s==null?void 0:s.id)&&t.status==="open"?()=>y(t.id):null}),(b||i)&&t.status!=="resolved"&&t.status!=="closed"&&e.jsx(S,{size:"xs",variant:"subtle",onClick:()=>ie(t.id,a),children:"Assign"})]})}],[y,b,i,s==null?void 0:s.id,a]);return e.jsxs(c.Container,{children:[e.jsx(c.Title,{icon:e.jsx(z,{size:25}),title:"IT Tickets",actions:e.jsxs(w,{gap:"xs",children:[e.jsx(S,{variant:"subtle",size:"xs",leftSection:e.jsx(oe,{size:16}),onClick:C,loading:k,children:"Export"}),e.jsx(Z,{variant:"default",size:"xs",onClick:()=>re(a),children:"Add Ticket"})]})}),e.jsx(c.Filters,{filters:x.filters,onClear:x.clear}),e.jsx(c.Content,{children:e.jsx(c.Table,{striped:!0,minHeight:240,noRecordsText:c.noRecordsText("IT tickets"),recordsPerPageLabel:c.recordsPerPageLabel("IT tickets"),paginationText:c.paginationText("IT tickets"),page:r,records:(o==null?void 0:o.data)??[],fetching:h,onPageChange:j,recordsPerPage:m,totalRecords:((R=o==null?void 0:o.meta)==null?void 0:R.total)??0,onRecordsPerPageChange:g,recordsPerPageOptions:[5,15,30],sortStatus:T.status,onSortStatusChange:T.change,columns:l,pinLastColumn:!0,highlightOnHover:!0})})]})}function Ne(){const{user:s}=L(),m=[{label:"IT Tickets",href:(s==null?void 0:s.role)==="MANAGER"?E.manager.itTickets:E.employee.itTickets}];return e.jsxs(K,{title:"IT Tickets",children:[e.jsx(V,{title:"IT Tickets",breadcrumbs:m}),e.jsxs(p,{gap:"lg",children:[e.jsx(ne,{}),e.jsx(ge,{})]})]})}export{Ne as default};
