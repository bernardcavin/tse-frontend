import{r as y,j as t,aw as Te,ax as Ot,U as Ie,ay as we,h as Ge,az as Ct,f as At,u as Ht,aA as Ft,a as Mt,aB as de,v as Et,aC as De,aD as qt,aE as Vt,c as $t,aF as Lt,Y as re,Z as xe,_ as f,a1 as P,aG as me,ai as ve,aj as ye,ak as je,au as Y,av as W,S as q,Q as I,e as Ce,a7 as Ae,T as te,ad as Pe,m as Q,X as pe,aa as Kt}from"./index--ClWZahu.js";import{d as Be,n as Ut}from"./date-CCyo-1EX.js";import{F as D,T as Oe,G as E}from"./form-section-C5VgLGpa.js";import{u as Qe,F as Ye,I as Nt,C as It}from"./file-upload-DQ7A5yty.js";import{a as Gt}from"./facilities-BJtlO5v9.js";import{h as He,F as Fe}from"./form-CN9S1QwI.js";import{u as Me,z as Ee}from"./use-form-L8LbUW_M.js";import{I as Bt,a as Qt}from"./IconPlus-BmH8SaqF.js";import{I as Yt}from"./IconCheck-DpEWvlmQ.js";import{S as Wt,C as N}from"./Select-UMZ64bLE.js";import{D as Zt}from"./DatePickerInput-BeLOAKO0.js";function z(e){return e<10?`0${e}`:`${e}`}const Xt=e=>Number(e.toFixed(0)[0]),fe=y.forwardRef(({value:e,min:n,max:a,onChange:s,focusable:o,step:i,onNextInput:r,onPreviousInput:h,onFocus:b,readOnly:l,allowTemporaryZero:x=!1,...F},H)=>{const T=Xt(a),d=a+1-i,C=c=>{if(l)return;const w=c.replace(/\D/g,"");if(w!==""){const A=parseInt(w,10),$=x&&A===0&&n>0?0:Te(A,n,a);s($),($>T||c.startsWith("00"))&&(r==null||r())}},V=c=>{if(!l){if((c.key==="0"||c.key==="Num0")&&e===0&&(c.preventDefault(),r==null||r()),c.key==="Home"&&(c.preventDefault(),s(n)),c.key==="End"&&(c.preventDefault(),s(a)),(c.key==="Backspace"||c.key==="Delete")&&(c.preventDefault(),e!==null?s(null):h==null||h()),c.key==="ArrowRight"&&(c.preventDefault(),r==null||r()),c.key==="ArrowLeft"&&(c.preventDefault(),h==null||h()),c.key==="ArrowUp"){c.preventDefault();const w=e===null?n:Te(e+i,n,d);s(w)}if(c.key==="ArrowDown"){c.preventDefault();const w=e===null?d:Te(e-i,n,d);s(w)}}};return t.jsx("input",{ref:H,type:"text",role:"spinbutton","aria-valuemin":n,"aria-valuemax":a,"aria-valuenow":e===null?0:e,"data-empty":e===null||void 0,inputMode:"numeric",placeholder:"--",value:e===null?"":z(e),onChange:c=>C(c.currentTarget.value),onKeyDown:V,onFocus:c=>{c.currentTarget.select(),b==null||b(c)},onClick:c=>{c.stopPropagation(),c.currentTarget.select()},onMouseDown:c=>c.stopPropagation(),...F})});fe.displayName="@mantine/dates/SpinInput";const[Jt,Z]=Ot("TimeInput component was not found in the component tree"),We=y.forwardRef(({labels:e,value:n,onChange:a,className:s,style:o,onPreviousInput:i,readOnly:r,onMouseDown:h,onTouchStart:b,inputType:l,...x},F)=>{const H=Z(),T=d=>{r||(d.key==="Home"&&(d.preventDefault(),a(e.am)),d.key==="End"&&(d.preventDefault(),a(e.pm)),(d.key==="Backspace"||d.key==="Delete")&&(d.preventDefault(),n===null?i==null||i():a(null)),d.key==="ArrowLeft"&&(d.preventDefault(),i==null||i()),(d.key==="ArrowUp"||d.key==="ArrowDown")&&(d.preventDefault(),a(n===e.am?e.pm:e.am)),d.code==="KeyA"&&(d.preventDefault(),a(e.am)),d.code==="KeyP"&&(d.preventDefault(),a(e.pm)))};return l==="input"?t.jsx("input",{...H.getStyles("field",{className:s,style:o}),ref:F,value:n||"--",onChange:d=>!r&&a(d.target.value||null),onClick:d=>d.stopPropagation(),onKeyDown:T,onMouseDown:d=>{d.stopPropagation(),h==null||h(d)},"data-am-pm":!0,...x}):t.jsxs("select",{...H.getStyles("field",{className:s,style:o}),ref:F,value:n||"",onChange:d=>!r&&a(d.target.value||null),onClick:d=>d.stopPropagation(),onKeyDown:T,onMouseDown:d=>{d.stopPropagation(),h==null||h(d)},"data-am-pm":!0,...x,children:[t.jsx("option",{value:"",children:"--"}),t.jsx("option",{value:e.am,children:e.am}),t.jsx("option",{value:e.pm,children:e.pm})]})});We.displayName="@mantine/dates/AmPmInput";function qe({value:e,active:n,onSelect:a}){const s=Z();return t.jsx(Ie,{mod:{active:n},onClick:()=>a(e),onMouseDown:o=>o.preventDefault(),"data-value":e,tabIndex:-1,...s.getStyles("control"),children:typeof e=="number"?z(e):e})}qe.displayName="@mantine/dates/TimeControl";function Ze({labels:e,value:n,onSelect:a}){const s=Z(),o=[e.am,e.pm].map(i=>t.jsx(qe,{value:i,active:n===i,onSelect:a},i));return t.jsx("div",{...s.getStyles("controlsList"),children:o})}Ze.displayName="@mantine/dates/AmPmControlsList";function es(e,n){if(!e||!n)return!1;const a=e.getBoundingClientRect(),s=n.getBoundingClientRect();return a.top>=s.top&&a.bottom<=s.bottom&&a.left>=s.left&&a.right<=s.right}function ts(e,n,a){const s=[];for(let o=e;o<=n;o+=a)s.push(o);return s}function he({min:e,max:n,step:a,value:s,onSelect:o}){const i=Z(),r=y.useRef(null),b=ts(e,n,a).map(l=>t.jsx(qe,{value:l,active:s===l,onSelect:o},l));return y.useEffect(()=>{var l;if(s!==null){const x=(l=r.current)==null?void 0:l.querySelector(`[data-value="${s}"]`);es(x,r.current)||x==null||x.scrollIntoView({block:"nearest"})}},[s]),t.jsx(we,{h:i.maxDropdownContentHeight,type:"never",viewportRef:r,...i.getStyles("scrollarea"),...i.scrollAreaProps,children:t.jsx("div",{...i.getStyles("controlsList"),children:b})})}he.displayName="@mantine/dates/TimeControlsList";function _e(e){const[n=null,a=null,s=null]=e.split(":").map(Number);return{hours:n,minutes:a,seconds:s}}function Xe({time:e,compare:n,withSeconds:a}){const s=_e(e),o=_e(n);return a?s.hours===o.hours&&s.minutes===o.minutes&&s.seconds===o.seconds:s.hours===o.hours&&s.minutes===o.minutes}function ss(e,n){return`${e.getHours()}:${e.getMinutes()}${n?`:${e.getSeconds()}`:""}`}function as({value:e,format:n,amPmLabels:a,withSeconds:s}){const o=_e(typeof e=="string"?e:ss(e,s));if(o.hours===null||o.minutes===null)return null;if(n==="24h")return`${z(o.hours)}:${z(o.minutes)}${s?`:${z(o.seconds||0)}`:""}`;const i=o.hours>=12;return`${o.hours%12===0?12:o.hours%12}:${z(o.minutes)}${s?`:${z(o.seconds||0)}`:""} ${i?a.pm:a.am}`}function Je({value:e,format:n="24h",amPmLabels:a={am:"AM",pm:"PM"},withSeconds:s=!1}){return t.jsx(t.Fragment,{children:as({value:e,format:n,amPmLabels:a,withSeconds:s})})}Je.displayName="@mantine/dates/TimeValue";function Ve({value:e,active:n,onChange:a,format:s,amPmLabels:o,withSeconds:i}){const r=Z();return t.jsx(Ie,{mod:{active:n},onClick:()=>a(e),...r.getStyles("presetControl"),children:t.jsx(Je,{withSeconds:i,value:e,format:s,amPmLabels:o})})}Ve.displayName="@mantine/dates/TimePresetControl";function et({value:e,data:n,onChange:a,format:s,amPmLabels:o,withSeconds:i}){const r=Z(),h=n.values.map(b=>t.jsx(Ve,{value:b,format:s,amPmLabels:o,withSeconds:i,active:Xe({time:b,compare:e,withSeconds:i}),onChange:a},b));return t.jsxs("div",{...r.getStyles("presetsGroup"),children:[t.jsx("div",{...r.getStyles("presetsGroupLabel"),children:n.label}),t.jsx(Ge,{cols:i?2:3,spacing:4,children:h})]})}et.displayName="@mantine/dates/TimePresetGroup";function tt({presets:e,format:n,amPmLabels:a,withSeconds:s,value:o,onChange:i}){const r=Z();if(e.length===0)return null;if(typeof e[0]=="string"){const b=e.map(l=>t.jsx(Ve,{value:l,format:n,amPmLabels:a,withSeconds:s,active:Xe({time:l,compare:o,withSeconds:s}),onChange:i},l));return t.jsx(we.Autosize,{mah:r.maxDropdownContentHeight,type:"never",...r.getStyles("scrollarea"),...r.scrollAreaProps,children:t.jsx("div",{...r.getStyles("presetsRoot"),children:t.jsx(Ge,{cols:s?2:3,spacing:4,children:b})})})}const h=e.map((b,l)=>t.jsx(et,{data:b,value:o,format:n,amPmLabels:a,withSeconds:s,onChange:i},l));return t.jsx(we.Autosize,{mah:r.maxDropdownContentHeight,type:"never",...r.getStyles("scrollarea"),...r.scrollAreaProps,children:t.jsx("div",{...r.getStyles("presetsRoot"),children:h})})}tt.displayName="@mantine/dates/TimePresets";function Re(e){const[n=0,a=0,s=0]=e.split(":").map(Number);return n*3600+a*60+s}function ns(e){const n=Math.floor(e/3600),a=Math.floor(e%3600/60),s=e%60;return{timeString:`${z(n)}:${z(a)}:${z(s)}`,hours:n,minutes:a,seconds:s}}function st(e,n,a){const s=Re(e),o=Re(n),i=Re(a),r=Math.max(o,Math.min(s,i));return ns(r)}function os({hours:e,minutes:n,seconds:a,amPmLabels:s}){if(e===null)return{hours:null,minutes:null,seconds:null,amPm:null};const o=e>=12?s.pm:s.am;return{hours:e%12===0?12:e%12,minutes:typeof n=="number"?n:null,seconds:typeof a=="number"?a:null,amPm:o}}function ie({time:e,format:n,amPmLabels:a}){if(e==="")return{hours:null,minutes:null,seconds:null,amPm:null};const{hours:s,minutes:o,seconds:i}=_e(e),r={hours:s,minutes:o,seconds:i};return n==="12h"?os({...r,amPmLabels:a}):{...r,amPm:null}}function is({hours:e,minutes:n,seconds:a,amPm:s,amPmLabels:o,withSeconds:i}){let r=e;return s===o.pm&&e!==12?r+=12:s===o.am&&e===12&&(r=0),`${z(r)}:${z(n)}${i?`:${z(a||0)}`:""}`}function be({hours:e,minutes:n,seconds:a,format:s,withSeconds:o,amPm:i,amPmLabels:r}){return e===null||n===null?{valid:!1,value:""}:o&&a===null?{valid:!1,value:""}:s==="24h"?{valid:!0,value:`${z(e)}:${z(n)}${o?`:${z(a)}`:""}`}:i===null?{valid:!1,value:""}:{valid:!0,value:is({hours:e,minutes:n,seconds:a,amPm:i,amPmLabels:r,withSeconds:o})}}function rs({value:e,defaultValue:n,onChange:a,format:s,amPmLabels:o,withSeconds:i=!1,min:r,max:h,clearable:b,readOnly:l,disabled:x,pasteSplit:F}){const H=ie({time:e||n||"",amPmLabels:o,format:s}),T=y.useRef(!0),[d,C]=y.useState(H.hours),[V,c]=y.useState(H.minutes),[w,A]=y.useState(H.seconds),[$,L]=y.useState(H.amPm),G=b&&!l&&!x&&(d!==null||V!==null||w!==null||$!==null),le=y.useRef(null),X=y.useRef(null),J=y.useRef(null),ee=y.useRef(null),M=u=>{var _,g,S,B;u==="hours"&&((_=le.current)==null||_.focus()),u==="minutes"&&((g=X.current)==null||g.focus()),u==="seconds"&&((S=J.current)==null||S.focus()),u==="amPm"&&((B=ee.current)==null||B.focus())},K=(u,_)=>{const g={hours:d,minutes:V,seconds:w,amPm:$,[u]:_},S=be({...g,format:s,withSeconds:i,amPmLabels:o});S.valid?(T.current=!1,u==="hours"&&C(_),u==="minutes"&&c(_),u==="seconds"&&A(_),u==="amPm"&&L(_),a==null||a(S.value)):(T.current=!1,typeof e=="string"&&e!==""&&(a==null||a("")))},Se=u=>{T.current=!1;const _=ie({time:u,amPmLabels:o,format:s});C(_.hours),c(_.minutes),A(_.seconds),L(_.amPm),a==null||a(u)},ue=u=>{let _=u;s==="12h"&&typeof u=="number"&&u>12&&(_=(u-1)%12+1),C(_),K("hours",_),M("hours")},ke=u=>{c(u),K("minutes",u),M("minutes")},se=u=>{A(u),K("seconds",u),M("seconds")},ae=u=>{L(u),K("amPm",u),M("amPm")},O=()=>{T.current=!1,C(null),c(null),A(null),L(null),a==null||a(""),M("hours")},j=u=>{u.preventDefault();const _=u.clipboardData.getData("text"),g=(F||ie)({time:_,format:s,amPmLabels:o}),S=be({...g,format:s,withSeconds:i,amPmLabels:o});if(S.valid){T.current=!1;const B=st(S.value,r||"00:00:00",h||"23:59:59");a==null||a(B.timeString),C(g.hours),c(g.minutes),A(g.seconds),L(g.amPm)}},R=be({hours:d,minutes:V,seconds:w,format:s,withSeconds:i,amPm:$,amPmLabels:o});return Ct(()=>{if(e===""){T.current=!1,C(null),c(null),A(null),L(null);return}if(T.current&&typeof e=="string"){const u=ie({time:e||"",amPmLabels:o,format:s});C(u.hours),c(u.minutes),A(u.seconds),L(u.amPm)}T.current=!0},[e]),{refs:{hours:le,minutes:X,seconds:J,amPm:ee},values:{hours:d,minutes:V,seconds:w,amPm:$},setHours:ue,setMinutes:ke,setSeconds:se,setAmPm:ae,focus:M,clear:O,onPaste:j,setTimeString:Se,isClearable:G,hiddenInputValue:R.value}}var at={fieldsRoot:"m_7a8f1e6d",fieldsGroup:"m_d6bb0a54",controlsList:"m_b97ecb26",controlsListGroup:"m_31fe42f9",dropdown:"m_9c4817c3",control:"m_154c536b",presetControl:"m_7be09d0c",presetsGroup:"m_7d00001d",presetsGroupLabel:"m_d8d918d7",field:"m_6b43ba88"};const ls={hoursStep:1,minutesStep:1,secondsStep:1,format:"24h",amPmLabels:{am:"AM",pm:"PM"},pasteSplit:ie,maxDropdownContentHeight:200},us=$t((e,{size:n})=>({dropdown:{"--control-font-size":Lt(n)}})),$e=At((e,n)=>{const a=Ht("TimePicker",ls,e),{classNames:s,className:o,style:i,styles:r,unstyled:h,vars:b,onClick:l,format:x,value:F,defaultValue:H,onChange:T,hoursStep:d,minutesStep:C,secondsStep:V,withSeconds:c,hoursInputLabel:w,minutesInputLabel:A,secondsInputLabel:$,amPmInputLabel:L,amPmLabels:G,clearable:le,onMouseDown:X,onFocusCapture:J,onBlurCapture:ee,min:M,max:K,popoverProps:Se,withDropdown:ue,rightSection:ke,onFocus:se,onBlur:ae,clearButtonProps:O,hoursInputProps:j,minutesInputProps:R,secondsInputProps:u,amPmSelectProps:_,readOnly:g,disabled:S,size:B,name:ct,form:dt,hiddenInputProps:mt,labelProps:pt,pasteSplit:ft,hoursRef:ht,minutesRef:bt,secondsRef:_t,amPmRef:xt,presets:Ke,maxDropdownContentHeight:vt,scrollAreaProps:yt,attributes:jt,...gt}=a,{resolvedClassNames:St,resolvedStyles:kt}=Ft({classNames:s,styles:r,props:a}),U=Mt({name:"TimePicker",classes:at,props:a,className:o,style:i,classNames:s,styles:r,unstyled:h,attributes:jt,vars:b,varsResolver:us}),m=rs({value:F,defaultValue:H,onChange:T,format:x,amPmLabels:G,withSeconds:c,min:M,max:K,clearable:le,disabled:S,readOnly:g,pasteSplit:ft}),zt=de(m.refs.hours,ht),Tt=de(m.refs.minutes,bt),Dt=de(m.refs.seconds,_t),Pt=de(m.refs.amPm,xt),Ue=Et(),ze=y.useRef(!1),[Rt,Ne]=y.useState(!1),ce=p=>{ze.current||(ze.current=!0,se==null||se(p))},wt=p=>{if(!p.currentTarget.contains(p.relatedTarget)){const v=m.values,ne=be({...v,format:x,amPmLabels:G,withSeconds:!!c});if(ne.valid&&M&&K){const oe=st(ne.value,M,K);oe.timeString!==ne.value&&m.setTimeString(oe.timeString)}ze.current=!1,ae==null||ae(p)}};return t.jsx(Jt,{value:{getStyles:U,scrollAreaProps:yt,maxDropdownContentHeight:vt},children:t.jsxs(De,{opened:Rt,transitionProps:{duration:0},position:"bottom-start",withRoles:!1,disabled:S||g||!ue,...Se,children:[t.jsx(De.Target,{children:t.jsxs(qt,{component:"div",size:B,disabled:S,ref:n,onClick:p=>{l==null||l(p),m.focus("hours")},onMouseDown:p=>{p.preventDefault(),X==null||X(p)},onFocusCapture:p=>{Ne(!0),J==null||J(p)},onBlurCapture:p=>{Ne(!1),ee==null||ee(p)},rightSection:ke||m.isClearable&&t.jsx(Vt,{...O,size:B,onClick:p=>{var v;m.clear(),(v=O==null?void 0:O.onClick)==null||v.call(O,p)},onMouseDown:p=>{var v;p.preventDefault(),(v=O==null?void 0:O.onMouseDown)==null||v.call(O,p)}}),labelProps:{htmlFor:Ue,...pt},style:i,className:o,classNames:St,styles:kt,__staticSelector:"TimePicker",...gt,children:[t.jsx("div",{...U("fieldsRoot"),dir:"ltr",children:t.jsxs("div",{...U("fieldsGroup"),onBlur:wt,children:[t.jsx(fe,{id:Ue,...j,...U("field",{className:j==null?void 0:j.className,style:j==null?void 0:j.style}),value:m.values.hours,onChange:m.setHours,onNextInput:()=>m.focus("minutes"),min:x==="12h"?1:0,max:x==="12h"?12:23,allowTemporaryZero:x==="12h",focusable:!0,step:d,ref:zt,"aria-label":w,readOnly:g,disabled:S,onPaste:m.onPaste,onFocus:p=>{var v;ce(p),(v=j==null?void 0:j.onFocus)==null||v.call(j,p)},onBlur:p=>{var oe;const v=p.currentTarget.value,ne=v?parseInt(v,10):null;x==="12h"&&ne===0&&m.setHours(12),(oe=j==null?void 0:j.onBlur)==null||oe.call(j,p)}}),t.jsx("span",{children:":"}),t.jsx(fe,{...R,...U("field",{className:R==null?void 0:R.className,style:R==null?void 0:R.style}),value:m.values.minutes,onChange:m.setMinutes,min:0,max:59,focusable:!0,step:C,ref:Tt,onPreviousInput:()=>m.focus("hours"),onNextInput:()=>c?m.focus("seconds"):m.focus("amPm"),"aria-label":A,tabIndex:-1,readOnly:g,disabled:S,onPaste:m.onPaste,onFocus:p=>{var v;ce(p),(v=R==null?void 0:R.onFocus)==null||v.call(R,p)}}),c&&t.jsxs(t.Fragment,{children:[t.jsx("span",{children:":"}),t.jsx(fe,{...u,...U("field",{className:u==null?void 0:u.className,style:u==null?void 0:u.style}),value:m.values.seconds,onChange:m.setSeconds,min:0,max:59,focusable:!0,step:V,ref:Dt,onPreviousInput:()=>m.focus("minutes"),onNextInput:()=>m.focus("amPm"),"aria-label":$,tabIndex:-1,readOnly:g,disabled:S,onPaste:m.onPaste,onFocus:p=>{var v;ce(p),(v=u==null?void 0:u.onFocus)==null||v.call(u,p)}})]}),x==="12h"&&t.jsx(We,{..._,inputType:ue?"input":"select",labels:G,value:m.values.amPm,onChange:m.setAmPm,ref:Pt,"aria-label":L,onPreviousInput:()=>c?m.focus("seconds"):m.focus("minutes"),readOnly:g,disabled:S,tabIndex:-1,onPaste:m.onPaste,onFocus:p=>{var v;ce(p),(v=_==null?void 0:_.onFocus)==null||v.call(_,p)}})]})}),t.jsx("input",{type:"hidden",name:ct,form:dt,value:m.hiddenInputValue,...mt})]})}),t.jsx(De.Dropdown,{...U("dropdown"),onMouseDown:p=>p.preventDefault(),children:Ke?t.jsx(tt,{value:m.hiddenInputValue,onChange:m.setTimeString,format:x,presets:Ke,amPmLabels:G,withSeconds:c||!1}):t.jsxs("div",{...U("controlsListGroup"),children:[t.jsx(he,{min:x==="12h"?1:0,max:x==="12h"?12:23,step:d,value:m.values.hours,onSelect:m.setHours}),t.jsx(he,{min:0,max:59,step:C,value:m.values.minutes,onSelect:m.setMinutes}),c&&t.jsx(he,{min:0,max:59,step:V,value:m.values.seconds,onSelect:m.setSeconds}),x==="12h"&&t.jsx(Ze,{labels:G,value:m.values.amPm,onSelect:m.setAmPm})]})})]})})});$e.displayName="@mantine/dates/TimePicker";$e.classes=at;const nt=re(["open","in_progress","resolved","closed"]),ot=re(["physical","chemical","biological","ergonomic","psychosocial"]),it=re(["hit_by_object","slip_trip_fall","short_circuit_burn","contact_hazard","environmental_pollution","other"]),rt=re(["inadequate_equipment","lack_of_knowledge","incorrect_ppe_use","procedure_violation","other"]),lt=re(["elimination","substitution","minimization","training","ppe","other"]),ge=xe({id:f().uuid().optional().nullable(),photo_file_ids:P(f().uuid()).optional().nullable(),observer_id:f().uuid(),observer_name:f().optional().nullable(),facility_id:f().uuid(),facility_name:f().optional().nullable(),observation_date:me.date(),observation_time:f(),unsafe_action_condition:f(),hazard_types:P(f()).optional().nullable(),potential_risks:P(f()).optional().nullable(),potential_risk_other:f().optional().nullable(),unsafe_reasons:P(f()).optional().nullable(),unsafe_reason_other:f().optional().nullable(),control_measures:P(f()).optional().nullable(),control_measure_other:f().optional().nullable(),corrective_action:f().optional().nullable(),status:nt,resolved_by_id:f().uuid().optional().nullable(),resolved_by_name:f().optional().nullable(),resolved_at:me.date().optional().nullable(),resolution_notes:f().optional().nullable(),created_at:me.date().optional().nullable(),updated_at:me.date().optional().nullable()}),cs=xe({facility_id:f().uuid(),observation_date:Be,observation_time:f(),unsafe_action_condition:f().min(10),hazard_types:P(ot).optional().nullable(),potential_risks:P(it).optional().nullable(),potential_risk_other:f().optional().nullable(),unsafe_reasons:P(rt).optional().nullable(),unsafe_reason_other:f().optional().nullable(),control_measures:P(lt).optional().nullable(),control_measure_other:f().optional().nullable(),corrective_action:f().optional().nullable(),photo_file_ids:P(f().uuid()).optional().nullable()}),ds=xe({facility_id:f().uuid().optional(),observation_date:Be.optional(),observation_time:f().optional(),unsafe_action_condition:f().optional(),hazard_types:P(ot).optional().nullable(),potential_risks:P(it).optional().nullable(),potential_risk_other:f().optional().nullable(),unsafe_reasons:P(rt).optional().nullable(),unsafe_reason_other:f().optional().nullable(),control_measures:P(lt).optional().nullable(),control_measure_other:f().optional().nullable(),corrective_action:f().optional().nullable(),status:nt.optional(),photo_file_ids:P(f().uuid()).optional().nullable()}),ms=xe({resolution_notes:f().min(10)});async function ps(e){const n=await Y.post("hazard-observations",e);return ge.parse(W.parse(n.data).data)}async function fs(e,n){const a=await Y.put(`hazard-observations/${e}`,n);return ge.parse(W.parse(a.data).data)}async function hs(e){const n=await Y.delete(`hazard-observations/${e}`);return W.parse(n.data)}async function bs(e){const n=await Y.get(`hazard-observations/${e}`);return ge.parse(W.parse(n.data).data)}async function _s(e,n){const a=await Y.put(`hazard-observations/${e}/resolve`,n);return ge.parse(W.parse(a.data).data)}function $s(){return ve({queryKey:["hazard-observations"],queryFn:async()=>{const e=await Y.get("hazard-observations");return W.parse(e.data).data}})}function Le(e){return ve({queryKey:["hazard-observation",e],queryFn:()=>bs(e),enabled:!!e})}function xs(){const e=ye();return je({mutationFn:ps,onSuccess:()=>{e.invalidateQueries({queryKey:["hazard-observations"]})}})}function vs(){const e=ye();return je({mutationFn:({id:n,data:a})=>fs(n,a),onSuccess:()=>{e.invalidateQueries({queryKey:["hazard-observations"]}),e.invalidateQueries({queryKey:["hazard-observation"]})}})}function Ls(){const e=ye();return je({mutationFn:hs,onSuccess:()=>{e.invalidateQueries({queryKey:["hazard-observations"]})}})}function ys(){const e=ye();return je({mutationFn:async({id:n,data:a})=>_s(n,a),onSuccess:()=>{e.invalidateQueries({queryKey:["hazard-observations"]}),e.invalidateQueries({queryKey:["hazard-observation"]}),e.invalidateQueries({queryKey:["hazard-analytics"]})}})}function Ks(){return ve({queryKey:["hazard-analytics"],queryFn:async()=>{const e=await Y.get("hazard-observations/analytics/summary");return W.parse(e.data).data}})}const js=[{value:"physical",label:"Physical (Fisik)"},{value:"chemical",label:"Chemical (Kimia)"},{value:"biological",label:"Biological (Biologi)"},{value:"ergonomic",label:"Ergonomic (Ergonomi)"},{value:"psychosocial",label:"Psychosocial (Psikososial)"}],gs=[{value:"hit_by_object",label:"Hit by Object (Menabrak/Ditabrak)"},{value:"slip_trip_fall",label:"Slip/Trip/Fall (Terpeleset/Tersandung/Terjatuh)"},{value:"short_circuit_burn",label:"Short Circuit/Burn (Arus Pendek/Terbakar)"},{value:"contact_hazard",label:"Contact Hazard (Kontak Panas/Listrik/Kimia)"},{value:"environmental_pollution",label:"Environmental Pollution (Pencemaran)"},{value:"other",label:"Other (Lain-Lain)"}],Ss=[{value:"inadequate_equipment",label:"Inadequate Equipment (Peralatan Tidak Memadai)"},{value:"lack_of_knowledge",label:"Lack of Knowledge (Kurang Pengetahuan)"},{value:"incorrect_ppe_use",label:"Incorrect PPE Use (Penggunaan APD Tidak Tepat)"},{value:"procedure_violation",label:"Procedure Violation (Melanggar Prosedur)"},{value:"other",label:"Other (Lain-Lain)"}],ks=[{value:"elimination",label:"Elimination (Eliminasi)"},{value:"substitution",label:"Substitution (Substitusi)"},{value:"minimization",label:"Minimization (Minimalisasi)"},{value:"training",label:"Training (Pelatihan)"},{value:"ppe",label:"PPE / APD (Alat Pelindung Diri)"},{value:"other",label:"Other (Lain-Lain)"}];function ut({form:e}){const{data:n,isLoading:a}=ve({queryKey:["facilityOptions"],queryFn:Gt}),[s,o]=y.useState(!1),[i,r]=y.useState(!1),[h,b]=y.useState(!1);return y.useEffect(()=>{const l=e.values.potential_risks||[];o(l.includes("other"))},[e.values.potential_risks]),y.useEffect(()=>{const l=e.values.unsafe_reasons||[];r(l.includes("other"))},[e.values.unsafe_reasons]),y.useEffect(()=>{const l=e.values.control_measures||[];b(l.includes("other"))},[e.values.control_measures]),t.jsxs(q,{gap:"md",children:[t.jsx(Nt,{name:"photo_file_ids",title:"Photos",multiple:!0,description:"Upload photos of the hazard observation"}),t.jsx(D,{title:"Observer Information (Informasi Pengamat)",children:t.jsxs(E,{children:[t.jsx(E.Col,{span:{base:12,sm:6},children:t.jsx(Wt,{label:"Facility",placeholder:"Select facility",data:n||[],...e.getInputProps("facility_id"),searchable:!0,required:!0,disabled:a,comboboxProps:{zIndex:2001}})}),t.jsx(E.Col,{span:{base:12,sm:3},children:t.jsx(Zt,{label:"Observation Date",placeholder:"Select date",...e.getInputProps("observation_date"),valueFormat:"DD/MM/YYYY",required:!0,popoverProps:{zIndex:2001}})}),t.jsx(E.Col,{span:{base:12,sm:3},children:t.jsx($e,{label:"Observation Time",...e.getInputProps("observation_time"),required:!0,format:"24h"})})]})}),t.jsx(D,{title:"Unsafe Action/Condition (Tindakan/Kondisi Tidak Aman)",children:t.jsx(Oe,{label:"Description",placeholder:"Describe the unsafe action or condition observed...",...e.getInputProps("unsafe_action_condition"),minRows:3,required:!0})}),t.jsx(D,{title:"Hazard Types (Bahaya)",children:t.jsx(N.Group,{...e.getInputProps("hazard_types"),children:t.jsx(q,{gap:"xs",children:js.map(l=>t.jsx(N,{value:l.value,label:l.label},l.value))})})}),t.jsxs(D,{title:"Potential Risks (Resiko Potensial)",children:[t.jsx(N.Group,{...e.getInputProps("potential_risks"),children:t.jsx(q,{gap:"xs",children:gs.map(l=>t.jsx(N,{value:l.value,label:l.label},l.value))})}),s&&t.jsx(Pe,{label:"Other Potential Risk Details",placeholder:"Specify other potential risk...",...e.getInputProps("potential_risk_other"),mt:"sm"})]}),t.jsxs(D,{title:"Why Unsafe? (Mengapa Pekerjaan Ini Dilakukan Tidak Aman)",children:[t.jsx(N.Group,{...e.getInputProps("unsafe_reasons"),children:t.jsx(q,{gap:"xs",children:Ss.map(l=>t.jsx(N,{value:l.value,label:l.label},l.value))})}),i&&t.jsx(Pe,{label:"Other Unsafe Reason Details",placeholder:"Specify other reason...",...e.getInputProps("unsafe_reason_other"),mt:"sm"})]}),t.jsxs(D,{title:"Control Measures (Pengendalian yang Dilakukan)",children:[t.jsx(N.Group,{...e.getInputProps("control_measures"),children:t.jsx(q,{gap:"xs",children:ks.map(l=>t.jsx(N,{value:l.value,label:l.label},l.value))})}),h&&t.jsx(Pe,{label:"Other Control Measure Details",placeholder:"Specify other control measure...",...e.getInputProps("control_measure_other"),mt:"sm"})]}),t.jsx(D,{title:"Corrective Action (Tindakan Perbaikan/Saran)",children:t.jsx(Oe,{label:"Corrective Action or Suggestions",placeholder:"Describe corrective actions taken or suggested...",...e.getInputProps("corrective_action"),minRows:3})})]})}function zs({onSubmit:e}){const{mutate:n,isPending:a}=xs(),s=Me({mode:"controlled",validate:Ee(cs),initialValues:{facility_id:"",observation_date:Ut(new Date),observation_time:new Date().toTimeString().slice(0,5),unsafe_action_condition:"",hazard_types:[],potential_risks:[],potential_risk_other:"",unsafe_reasons:[],unsafe_reason_other:"",control_measures:[],control_measure_other:"",corrective_action:""}}),o=Qe(),{updateFilesMetadata:i}=o,r=s.onSubmit(h=>{console.log(h),n(h,{onError:b=>He(s,b),onSuccess:()=>{e(),i()}})});return t.jsx(Fe,{form:s,onSubmit:r,children:t.jsx(Ye,{fileIdManager:o,children:t.jsxs(q,{children:[t.jsx(ut,{form:s}),t.jsx(I,{justify:"flex-end",children:t.jsx(Ce,{type:"submit",loading:a,mt:"md",leftSection:t.jsx(Bt,{size:16,stroke:5}),children:"Add Observation"})})]})})})}function Ts({onSubmit:e,id:n}){const{mutate:a,isPending:s}=vs(),{data:o,isLoading:i}=Le(n),r=Me({mode:"controlled",validate:Ee(ds)});y.useEffect(()=>{o&&r.setValues({...o,observation_date:new Date(o.observation_date)})},[o]);const h=Qe(),{updateFilesMetadata:b}=h,l=r.onSubmit(x=>{a({id:n,data:x},{onError:F=>He(r,F),onSuccess:()=>{e(),b()}})});return i?t.jsx(Ae,{color:"blue",size:"xl"}):t.jsx(Fe,{form:r,onSubmit:l,children:t.jsx(Ye,{fileIdManager:h,children:t.jsxs(q,{children:[t.jsx(ut,{form:r}),t.jsx(I,{justify:"flex-end",children:t.jsx(Ce,{type:"submit",loading:s,mt:"md",leftSection:t.jsx(Qt,{size:16,stroke:2}),children:"Save Changes"})})]})})})}function Ds({onSubmit:e,id:n}){const{mutate:a,isPending:s}=ys(),{data:o,isLoading:i}=Le(n),r=Me({mode:"controlled",validate:Ee(ms),initialValues:{resolution_notes:""}}),h=r.onSubmit(b=>{a({id:n,data:b},{onError:l=>He(r,l),onSuccess:()=>{e()}})});return i?t.jsx(Ae,{color:"blue",size:"xl"}):t.jsx(Fe,{form:r,onSubmit:h,children:t.jsxs(q,{children:[t.jsxs(D,{title:"Observation Details",children:[t.jsxs(te,{size:"sm",children:[t.jsx("strong",{children:"Facility:"})," ",o==null?void 0:o.facility_id]}),t.jsxs(te,{size:"sm",children:[t.jsx("strong",{children:"Date:"})," ",o!=null&&o.observation_date?new Date(o.observation_date).toLocaleDateString():"-"]}),t.jsxs(te,{size:"sm",children:[t.jsx("strong",{children:"Unsafe Condition:"})," ",o==null?void 0:o.unsafe_action_condition]})]}),t.jsx(D,{title:"Resolution Notes (HSE)",children:t.jsx(Oe,{name:"resolution_notes",label:"Resolution Notes",placeholder:"Describe how this hazard was resolved...",...r.getInputProps("resolution_notes"),minRows:4,required:!0,description:"Provide detailed information about the resolution actions taken"})}),t.jsx(I,{justify:"flex-end",children:t.jsx(Ce,{type:"submit",loading:s,color:"green",leftSection:t.jsx(Yt,{size:16,stroke:2}),children:"Mark as Resolved"})})]})})}function Ps({id:e}){const{data:n,isLoading:a}=Le(e);if(a)return t.jsx(I,{justify:"center",py:"xl",children:t.jsx(Ae,{size:"lg"})});if(!n)return t.jsx(te,{c:"dimmed",ta:"center",py:"xl",children:"No observation data found."});const s=n;return t.jsxs(q,{gap:"lg",children:[s.photo_file_ids&&s.photo_file_ids.length>0&&t.jsx(D,{title:"Photos",children:t.jsx(It,{file_ids:s.photo_file_ids,alt:"Hazard Observation"})}),t.jsx(D,{title:"Observer Information",children:t.jsxs(E,{children:[t.jsxs(E.Col,{span:{base:12,sm:6},children:[t.jsx(k,{label:"Observer",value:s.observer_name||s.observer_id}),t.jsx(k,{label:"Facility",value:s.facility_name||s.facility_id})]}),t.jsxs(E.Col,{span:{base:12,sm:6},children:[t.jsx(k,{label:"Observation Date",value:new Date(s.observation_date).toLocaleDateString()}),t.jsx(k,{label:"Observation Time",value:s.observation_time})]})]})}),t.jsxs(D,{title:"Observation Details",children:[t.jsx(k,{label:"Unsafe Action/Condition",value:s.unsafe_action_condition}),t.jsx(k,{label:"Hazard Types",value:s.hazard_types&&s.hazard_types.length>0?t.jsx(I,{gap:4,children:s.hazard_types.map((o,i)=>t.jsx(pe,{children:o},i))}):"-"}),t.jsx(k,{label:"Potential Risks",value:s.potential_risks&&s.potential_risks.length>0?t.jsx(I,{gap:4,children:s.potential_risks.map((o,i)=>t.jsx(pe,{color:"orange",children:o},i))}):"-"}),s.potential_risk_other&&t.jsx(k,{label:"Other Potential Risk",value:s.potential_risk_other})]}),t.jsxs(D,{title:"Why Unsafe",children:[t.jsx(k,{label:"Unsafe Reasons",value:s.unsafe_reasons&&s.unsafe_reasons.length>0?t.jsx(I,{gap:4,children:s.unsafe_reasons.map((o,i)=>t.jsx(pe,{color:"red",children:o},i))}):"-"}),s.unsafe_reason_other&&t.jsx(k,{label:"Other Unsafe Reason",value:s.unsafe_reason_other})]}),t.jsxs(D,{title:"Control Measures",children:[t.jsx(k,{label:"Control Measures",value:s.control_measures&&s.control_measures.length>0?t.jsx(I,{gap:4,children:s.control_measures.map((o,i)=>t.jsx(pe,{color:"green",children:o},i))}):"-"}),s.control_measure_other&&t.jsx(k,{label:"Other Control Measure",value:s.control_measure_other}),t.jsx(k,{label:"Corrective Action",value:s.corrective_action})]}),s.status==="resolved"&&s.resolution_notes&&t.jsx(D,{title:"Resolution Information",children:t.jsxs(E,{children:[t.jsxs(E.Col,{span:{base:12,sm:6},children:[t.jsx(k,{label:"Resolved By",value:s.resolved_by_name||s.resolved_by_id||"N/A"}),t.jsx(k,{label:"Resolved At",value:s.resolved_at?new Date(s.resolved_at).toLocaleString():"-"})]}),t.jsx(E.Col,{span:12,children:t.jsx(k,{label:"Resolution Notes",value:s.resolution_notes})})]})})]})}function k({label:e,value:n}){return t.jsxs(q,{gap:2,mb:"sm",children:[t.jsx(te,{c:"dimmed",fz:"sm",children:e}),t.jsx(te,{fw:500,style:{wordBreak:"break-word"},children:n??"-"}),t.jsx(Kt,{my:4})]})}function Us(e){Q.open({title:"Add New Hazard Observation Card",children:t.jsx(zs,{onSubmit:()=>{e(),Q.closeAll()}}),size:"75rem",zIndex:2e3,withCloseButton:!1})}function Ns(e,n){Q.open({title:"Edit Hazard Observation Card",children:t.jsx(Ts,{id:e,onSubmit:()=>{n(),Q.closeAll()}}),size:"75rem",zIndex:2e3,withCloseButton:!1})}function Is(e){Q.open({title:"View Hazard Observation Card",children:t.jsx(Ps,{id:e}),size:"75rem",zIndex:2e3,withCloseButton:!1})}function Gs(e,n){Q.open({title:"Resolve Hazard Observation",children:t.jsx(Ds,{id:e,onSubmit:()=>{n(),Q.closeAll()}}),size:"50rem",zIndex:2e3,withCloseButton:!1})}export{Is as a,Ks as b,Ls as c,Gs as d,Ns as e,Us as o,$s as u};
