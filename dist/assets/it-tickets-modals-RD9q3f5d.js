import{j as e,S as h,Q as b,e as T,r as R,a7 as y,T as u,ai as z,au as A,av as P,ad as B,m as p,X as w,aa as q}from"./index--ClWZahu.js";import{c as D,d as N,e as U,f,g as M,h as V,i as G,j as Y,k as H,I as K}from"./it-tickets-DsHk8ugn.js";import{F as d,T as O,G as a}from"./form-section-C5VgLGpa.js";import{u as F,F as L,I as Q,C as $}from"./file-upload-DQ7A5yty.js";import{a as X}from"./facilities-BJtlO5v9.js";import{h as I,F as v}from"./form-CN9S1QwI.js";import{u as _,z as S}from"./use-form-L8LbUW_M.js";import{I as J,a as W}from"./IconPlus-BmH8SaqF.js";import{I as Z}from"./IconCheck-DpEWvlmQ.js";import{S as g}from"./Select-UMZ64bLE.js";const ee=[{value:"hardware",label:"Hardware"},{value:"software",label:"Software"},{value:"network",label:"Network"},{value:"account_access",label:"Account/Access"},{value:"other",label:"Other"}],se=[{value:"low",label:"Low"},{value:"medium",label:"Medium"},{value:"high",label:"High"},{value:"critical",label:"Critical"}];async function te(){const i=await A.get("inventory",{params:{page_size:100}});return(P.parse(i.data).data.data||[]).map(n=>({value:n.id,label:`${n.item_name} (${n.item_code})`}))}async function ie(){const i=await A.get("auth/users",{params:{page_size:100}});return(P.parse(i.data).data.data||[]).map(n=>({value:n.id,label:n.name}))}function E({form:i}){const{data:o,isLoading:n}=z({queryKey:["facilityOptions"],queryFn:X}),{data:s,isLoading:t}=z({queryKey:["inventoryOptions"],queryFn:te});return e.jsxs(h,{gap:"md",children:[e.jsx(Q,{name:"photo_file_ids",title:"Attachments",multiple:!0,description:"Upload screenshots or relevant documents"}),e.jsx(d,{title:"Ticket Information",children:e.jsxs(a,{children:[e.jsx(a.Col,{span:12,children:e.jsx(B,{label:"Title",placeholder:"Brief title for the issue",...i.getInputProps("title"),required:!0})}),e.jsx(a.Col,{span:12,children:e.jsx(O,{label:"Description",placeholder:"Describe the issue in detail...",...i.getInputProps("description"),minRows:4,required:!0})}),e.jsx(a.Col,{span:{base:12,sm:6},children:e.jsx(g,{label:"Category",placeholder:"Select category",data:ee,...i.getInputProps("category"),required:!0,comboboxProps:{zIndex:2001}})}),e.jsx(a.Col,{span:{base:12,sm:6},children:e.jsx(g,{label:"Priority",placeholder:"Select priority",data:se,...i.getInputProps("priority"),required:!0,comboboxProps:{zIndex:2001}})})]})}),e.jsx(d,{title:"Location & Related Asset",children:e.jsxs(a,{children:[e.jsx(a.Col,{span:{base:12,sm:6},children:e.jsx(g,{label:"Facility (Optional)",placeholder:"Select facility",data:o||[],...i.getInputProps("facility_id"),searchable:!0,clearable:!0,disabled:n,comboboxProps:{zIndex:2001}})}),e.jsx(a.Col,{span:{base:12,sm:6},children:e.jsx(g,{label:"Related Inventory Item (Optional)",placeholder:"Link to IT asset",data:s||[],...i.getInputProps("inventory_item_id"),searchable:!0,clearable:!0,disabled:t,comboboxProps:{zIndex:2001}})})]})})]})}function oe({onSubmit:i}){const{mutate:o,isPending:n}=D(),s=_({mode:"controlled",validate:S(N),initialValues:{title:"",description:"",category:"other",priority:"medium",facility_id:null,inventory_item_id:null}}),t=F(),{updateFilesMetadata:x}=t,r=s.onSubmit(m=>{o(m,{onError:c=>I(s,c),onSuccess:()=>{i(),x()}})});return e.jsx(v,{form:s,onSubmit:r,children:e.jsx(L,{fileIdManager:t,children:e.jsxs(h,{children:[e.jsx(E,{form:s}),e.jsx(b,{justify:"flex-end",children:e.jsx(T,{type:"submit",loading:n,mt:"md",leftSection:e.jsx(J,{size:16,stroke:5}),children:"Create Ticket"})})]})})})}function ae({onSubmit:i,id:o}){const{mutate:n,isPending:s}=U(),{data:t,isLoading:x}=f(o),r=_({mode:"controlled",validate:S(M)});R.useEffect(()=>{t&&r.setValues({title:t.title,description:t.description,category:t.category,priority:t.priority,facility_id:t.facility_id,inventory_item_id:t.inventory_item_id})},[t]);const m=F(),{updateFilesMetadata:c}=m,j=r.onSubmit(C=>{n({id:o,data:C},{onError:k=>I(r,k),onSuccess:()=>{i(),c()}})});return x?e.jsx(y,{color:"blue",size:"xl"}):e.jsx(v,{form:r,onSubmit:j,children:e.jsx(L,{fileIdManager:m,children:e.jsxs(h,{children:[e.jsx(E,{form:r}),e.jsx(b,{justify:"flex-end",children:e.jsx(T,{type:"submit",loading:s,mt:"md",leftSection:e.jsx(W,{size:16,stroke:2}),children:"Save Changes"})})]})})})}function ne({onSubmit:i,id:o}){const{mutate:n,isPending:s}=V(),{data:t,isLoading:x}=f(o),r=_({mode:"controlled",validate:S(G),initialValues:{resolution_notes:""}}),m=r.onSubmit(c=>{n({id:o,data:c},{onError:j=>I(r,j),onSuccess:()=>{i()}})});return x?e.jsx(y,{color:"blue",size:"xl"}):e.jsx(v,{form:r,onSubmit:m,children:e.jsxs(h,{children:[e.jsxs(d,{title:"Ticket Details",children:[e.jsxs(u,{size:"sm",children:[e.jsx("strong",{children:"Title:"})," ",t==null?void 0:t.title]}),e.jsxs(u,{size:"sm",children:[e.jsx("strong",{children:"Category:"})," ",t==null?void 0:t.category]}),e.jsxs(u,{size:"sm",children:[e.jsx("strong",{children:"Description:"})," ",t==null?void 0:t.description]})]}),e.jsx(d,{title:"Resolution Notes",children:e.jsx(O,{name:"resolution_notes",label:"Resolution Notes",placeholder:"Describe how this issue was resolved...",...r.getInputProps("resolution_notes"),minRows:4,required:!0,description:"Provide detailed information about the resolution"})}),e.jsx(b,{justify:"flex-end",children:e.jsx(T,{type:"submit",loading:s,color:"green",leftSection:e.jsx(Z,{size:16,stroke:2}),children:"Mark as Resolved"})})]})})}function re({onSubmit:i,id:o}){const{mutate:n,isPending:s}=Y(),{data:t,isLoading:x}=f(o),{data:r,isLoading:m}=z({queryKey:["userOptions"],queryFn:ie}),c=_({mode:"controlled",validate:S(H),initialValues:{assigned_to_id:""}});R.useEffect(()=>{t!=null&&t.assigned_to_id&&c.setFieldValue("assigned_to_id",t.assigned_to_id)},[t]);const j=c.onSubmit(C=>{n({id:o,data:C},{onError:k=>I(c,k),onSuccess:()=>{i()}})});return x?e.jsx(y,{color:"blue",size:"xl"}):e.jsx(v,{form:c,onSubmit:j,children:e.jsxs(h,{children:[e.jsxs(d,{title:"Ticket Details",children:[e.jsxs(u,{size:"sm",children:[e.jsx("strong",{children:"Title:"})," ",t==null?void 0:t.title]}),e.jsxs(u,{size:"sm",children:[e.jsx("strong",{children:"Category:"})," ",t==null?void 0:t.category]}),e.jsxs(u,{size:"sm",children:[e.jsx("strong",{children:"Priority:"})," ",t==null?void 0:t.priority]})]}),e.jsx(d,{title:"Assignment",children:e.jsx(g,{label:"Assign To",placeholder:"Select IT staff",data:r||[],...c.getInputProps("assigned_to_id"),searchable:!0,required:!0,disabled:m,comboboxProps:{zIndex:2001}})}),e.jsx(b,{justify:"flex-end",children:e.jsx(T,{type:"submit",loading:s,color:"blue",leftSection:e.jsx(K,{size:16,stroke:2}),children:"Assign Ticket"})})]})})}const le={open:"red",in_progress:"yellow",resolved:"green",closed:"gray"},ce={open:"Open",in_progress:"In Progress",resolved:"Resolved",closed:"Closed"},de={hardware:"Hardware",software:"Software",network:"Network",account_access:"Account/Access",other:"Other"},ue={low:"Low",medium:"Medium",high:"High",critical:"Critical"},pe={low:"gray",medium:"blue",high:"orange",critical:"red"};function me({id:i}){const{data:o,isLoading:n}=f(i);if(n)return e.jsx(b,{justify:"center",py:"xl",children:e.jsx(y,{size:"lg"})});if(!o)return e.jsx(u,{c:"dimmed",ta:"center",py:"xl",children:"No ticket data found."});const s=o;return e.jsxs(h,{gap:"lg",children:[s.photo_file_ids&&s.photo_file_ids.length>0&&e.jsx(d,{title:"Attachments",children:e.jsx($,{file_ids:s.photo_file_ids,alt:"IT Ticket"})}),e.jsx(d,{title:"Ticket Information",children:e.jsxs(a,{children:[e.jsx(a.Col,{span:12,children:e.jsx(l,{label:"Title",value:s.title})}),e.jsx(a.Col,{span:{base:12,sm:6},children:e.jsx(l,{label:"Category",value:e.jsx(w,{variant:"light",children:de[s.category]||s.category})})}),e.jsx(a.Col,{span:{base:12,sm:6},children:e.jsx(l,{label:"Priority",value:e.jsx(w,{color:pe[s.priority]||"gray",children:ue[s.priority]||s.priority})})}),e.jsx(a.Col,{span:{base:12,sm:6},children:e.jsx(l,{label:"Status",value:e.jsx(w,{color:le[s.status]||"gray",children:ce[s.status]||s.status})})}),e.jsx(a.Col,{span:{base:12,sm:6},children:e.jsx(l,{label:"Created At",value:s.created_at?new Date(s.created_at).toLocaleString():"-"})})]})}),e.jsx(d,{title:"Description",children:e.jsx(u,{style:{whiteSpace:"pre-wrap"},children:s.description})}),e.jsx(d,{title:"Reporter & Assignment",children:e.jsxs(a,{children:[e.jsx(a.Col,{span:{base:12,sm:6},children:e.jsx(l,{label:"Reporter",value:s.reporter_name||s.reporter_id})}),e.jsx(a.Col,{span:{base:12,sm:6},children:e.jsx(l,{label:"Facility",value:s.facility_name||"-"})}),e.jsx(a.Col,{span:{base:12,sm:6},children:e.jsx(l,{label:"Assigned To",value:s.assigned_to_name||"Not assigned"})}),e.jsx(a.Col,{span:{base:12,sm:6},children:e.jsx(l,{label:"Related Inventory",value:s.inventory_item_name||"-"})})]})}),s.status==="resolved"&&s.resolution_notes&&e.jsx(d,{title:"Resolution Information",children:e.jsxs(a,{children:[e.jsxs(a.Col,{span:{base:12,sm:6},children:[e.jsx(l,{label:"Resolved By",value:s.resolved_by_name||s.resolved_by_id||"N/A"}),e.jsx(l,{label:"Resolved At",value:s.resolved_at?new Date(s.resolved_at).toLocaleString():"-"})]}),e.jsx(a.Col,{span:12,children:e.jsx(l,{label:"Resolution Notes",value:s.resolution_notes})})]})})]})}function l({label:i,value:o}){return e.jsxs(h,{gap:2,mb:"sm",children:[e.jsx(u,{c:"dimmed",fz:"sm",children:i}),e.jsx(u,{fw:500,style:{wordBreak:"break-word"},children:o??"-"}),e.jsx(q,{my:4})]})}function _e(i){p.open({title:"Create New IT Ticket",children:e.jsx(oe,{onSubmit:()=>{i(),p.closeAll()}}),size:"60rem",zIndex:2e3,withCloseButton:!1})}function Se(i,o){p.open({title:"Edit IT Ticket",children:e.jsx(ae,{id:i,onSubmit:()=>{o(),p.closeAll()}}),size:"60rem",zIndex:2e3,withCloseButton:!1})}function Ce(i){p.open({title:"View IT Ticket",children:e.jsx(me,{id:i}),size:"60rem",zIndex:2e3,withCloseButton:!1})}function ke(i,o){p.open({title:"Resolve IT Ticket",children:e.jsx(ne,{id:i,onSubmit:()=>{o(),p.closeAll()}}),size:"50rem",zIndex:2e3,withCloseButton:!1})}function we(i,o){p.open({title:"Assign IT Ticket",children:e.jsx(re,{id:i,onSubmit:()=>{o(),p.closeAll()}}),size:"40rem",zIndex:2e3,withCloseButton:!1})}export{Ce as a,ke as b,Se as c,we as d,_e as o};
